(()=>{"use strict";var e={};function t(e,t,n){var r=n.inactiveButtonClass;!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r),t.disabled=!1):(t.classList.add(r),t.disabled=!0)}function n(e){e.classList.add("popup_active")}function r(e){e.classList.remove("popup_active")}e.p="";var o={baseUrl:"https://nomoreparties.co/v1/plus-cohort-19",headers:{authorization:"d4f12ba4-cfb9-42d3-9303-686a046acbd3","Content-Type":"application/json"}};e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p;var c,a,u=document.getElementById("card-template").content,i=document.querySelector(".cards-gallery"),s=document.querySelector(".profile__avatar-container"),l=document.querySelector(".profile__avatar"),d=document.querySelector(".profile__name"),p=document.querySelector(".profile__subtitle"),f=document.querySelector(".profile__edit-button"),m=document.querySelector(".profile__add-button"),v=document.querySelectorAll(".popup"),_=document.querySelector(".popup_type_edit-avatar"),y=document.querySelector(".popup_type_edit-profile"),h=document.querySelector(".popup_type_add-card"),S=document.querySelector(".popup_type_delete-card"),b=document.querySelector(".popup_type_card"),E=_.querySelector(".popup__form"),q=y.querySelector(".popup__form"),k=h.querySelector(".popup__form"),L=S.querySelector(".popup__form"),C=document.getElementById("avatar-input"),g=document.getElementById("username-input"),j=document.getElementById("user-description-input"),x=document.getElementById("place-name-input"),P=document.getElementById("place-link-input"),B=b.querySelector(".popup__image"),U=b.querySelector(".popup__image-caption");function A(e,t,r,i,s){var l=u.querySelector(".card").cloneNode(!0),d=l.querySelector(".card__image");l.querySelector(".card__title").textContent=t,d.src=r,d.alt=t,l.dataset.id=s,d.addEventListener("click",(function(){n(b),B.src=r,B.alt=t,U.textContent=t}));var p=l.querySelector(".card__like-button"),f=l.querySelector(".card__likes-number");e&&(e.length>0&&(f.textContent=e.length),e.forEach((function(e){e._id===c&&p.classList.add("card__like-button_active")})),p.addEventListener("click",(function(){return function(e,t,n){t.classList.toggle("card__like-button_active"),Array.from(t.classList).includes("card__like-button_active")?function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(e){n.textContent=e.likes.length})):function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(e){n.textContent=e.likes.length}))}(s,p,f)})));var m=l.querySelector(".card__delete-button");return c===i?m.addEventListener("click",(function(){a=s,n(S)})):m.remove(),l}function T(e){i.prepend(e)}fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t=e.avatar,n=e.name,r=e.about,o=e._id;l.src=t,d.textContent=n,p.textContent=r,c=o})),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=e.likes,n=e.name,r=e.link,o=e.owner,c=e._id;T(A(t,n,r,o._id,c))}))})),document.addEventListener("keydown",(function(e){if("escape"===e.key.toLowerCase()){var t=document.querySelector(".popup_active");t&&r(t)}})),v.forEach((function(e){e.addEventListener("click",(function(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup"))&&r(e.currentTarget)}))})),f.addEventListener("click",(function(){g.value=d.textContent,j.value=p.textContent,n(y)})),s.addEventListener("click",(function(){return n(_)})),m.addEventListener("click",(function(){return n(h)})),E.addEventListener("submit",(function(){var e;event.preventDefault(),l.src=C.value,e={avatar:C.value},fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),r(_)})),q.addEventListener("submit",(function(){var e;event.preventDefault(),d.textContent=g.value,p.textContent=j.value,e={name:g.value,about:j.value},fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),r(y)})),k.addEventListener("submit",(function(){event.preventDefault();var e=A(0,x.value,P.value,c);(function(e){return fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})({name:x.value,link:P.value}).then((function(e){console.log(e)})),T(e),k.reset(),r(h)})),L.addEventListener("submit",(function(){return e=a,document.querySelector('[data-id="'.concat(e,'"]')).remove(),function(e){fetch("".concat(o.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e),void r(S);var e})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),function(e,n){var r=n.inputSelector,o=n.submitButtonSelector,c=Array.from(e.querySelectorAll(r)),a=e.querySelector(o);t(c,a,n),c.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var r=n.inputErrorClass,o=n.errorClass,c=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r),c.classList.remove(o),c.textContent=""}(e,t,n):function(e,t,n,r){var o=n.inputErrorClass,c=n.errorClass,a=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),a.textContent=r,a.classList.add(c)}(e,t,n,t.validationMessage)}(e,r,n),t(c,a,n)}))}))}(n,e)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"})})();