(()=>{"use strict";var e={};function t(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove("popup__button_inactive"):t.classList.add("popup__button_inactive")}function n(e){e.classList.add("popup_active")}function r(e){e.classList.remove("popup_active")}e.p="";var o={baseUrl:"https://nomoreparties.co/v1/plus-cohort-19",headers:{authorization:"d4f12ba4-cfb9-42d3-9303-686a046acbd3","Content-Type":"application/json"}};e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p;var c,a,u=document.getElementById("card-template").content,i=document.querySelector(".cards-gallery"),s=document.querySelector(".profile__avatar-container"),d=document.querySelector(".profile__avatar"),l=document.querySelector(".profile__name"),p=document.querySelector(".profile__subtitle"),_=document.querySelector(".profile__edit-button"),f=document.querySelector(".profile__add-button"),m=document.querySelectorAll(".popup"),v=document.querySelector(".popup_type_edit-avatar"),y=document.querySelector(".popup_type_edit-profile"),h=document.querySelector(".popup_type_add-card"),S=document.querySelector(".popup_type_delete-card"),b=document.querySelector(".popup_type_card"),q=v.querySelector(".popup__form"),E=y.querySelector(".popup__form"),k=h.querySelector(".popup__form"),L=S.querySelector(".popup__form"),g=document.getElementById("avatar-input"),j=document.getElementById("username-input"),C=document.getElementById("user-description-input"),x=document.getElementById("place-name-input"),P=document.getElementById("place-link-input"),U=b.querySelector(".popup__image"),A=b.querySelector(".popup__image-caption");function T(e,t,r,i,s){var d=u.querySelector(".card").cloneNode(!0),l=d.querySelector(".card__image");d.querySelector(".card__title").textContent=t,l.src=r,l.alt=t,d.dataset.id=s,l.addEventListener("click",(function(){n(b),U.src=r,U.alt=t,A.textContent=t}));var p=d.querySelector(".card__like-button"),_=d.querySelector(".card__likes-number");e&&(e.length>0&&(_.textContent=e.length),e.forEach((function(e){e._id===c&&p.classList.add("card__like-button_active")})),p.addEventListener("click",(function(){return function(e,t,n){t.classList.toggle("card__like-button_active"),Array.from(t.classList).includes("card__like-button_active")?function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(e){n.textContent=e.likes.length})):function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e).then((function(e){n.textContent=e.likes.length}))}(s,p,_)})));var f=d.querySelector(".card__delete-button");return c===i?f.addEventListener("click",(function(){a=s,n(S)})):f.remove(),d}function B(e){i.prepend(e)}fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t=e.avatar,n=e.name,r=e.about,o=e._id;d.src=t,l.textContent=n,p.textContent=r,c=o})),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){e.forEach((function(e){var t=e.likes,n=e.name,r=e.link,o=e.owner,c=e._id;B(T(t,n,r,o._id,c))}))})),document.addEventListener("keydown",(function(e){if("escape"===e.key.toLowerCase()){var t=document.querySelector(".popup_active");t&&r(t)}})),m.forEach((function(e){e.addEventListener("click",(function(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup"))&&r(e.currentTarget)}))})),_.addEventListener("click",(function(){j.value=l.textContent,C.value=p.textContent,n(y)})),s.addEventListener("click",(function(){return n(v)})),f.addEventListener("click",(function(){return n(h)})),q.addEventListener("submit",(function(){var e;event.preventDefault(),d.src=g.value,e={avatar:g.value},fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),r(v)})),E.addEventListener("submit",(function(){var e;event.preventDefault(),l.textContent=j.value,p.textContent=C.value,e={name:j.value,about:C.value},fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),r(y)})),k.addEventListener("submit",(function(){event.preventDefault();var e=T(0,x.value,P.value,c);(function(e){return fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify(e)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))})({name:x.value,link:P.value}).then((function(e){console.log(e)})),B(e),k.reset(),r(h)})),L.addEventListener("submit",(function(){return e=a,document.querySelector('[data-id="'.concat(e,'"]')).remove(),function(e){fetch("".concat(o.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(e),void r(S);var e})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var n=Array.from(e.querySelectorAll(".popup__input")),r=e.querySelector(".popup__button");t(n,r),n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t){t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__input-error_active"),n.textContent=""}(e,t):function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),r.textContent=n,r.classList.add("popup__input-error_active")}(e,t,t.validationMessage)}(e,o),t(n,r)}))}))}(e)}))})();